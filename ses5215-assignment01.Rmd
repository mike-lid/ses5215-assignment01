---
title: "**Assignment 01 - Group 3**"
author: "Daniel + Megan + Mike"
date: "26 October 2021"
output: 
  html_document:
    theme: readable
    toc: true
    toc_depth: 3
    toc_float:  true
---
<style>
body {
text-align: left}
</style>

<style>
body {
font-family: arial}
</style>


# research question
How well does a census tract’s percentage of single-family homes and location relative to metropolitan center predict the average home value and tenure period in homes for the Commonwealth of Massachusetts?

# prior research
While the correlation between diversity of housing types and racial and economic diversity in	neighborhoods have previously been established, this study investigated a potential 	relationship between housing typology and foreclosures. In fact, they found a positive (but varied) correlation between type and stability—neighborhoods with a range of housing stock had lower foreclosure and sales rates (Chakraborty et al 2018). Additionally, hedonic modelling of home values have been shown to respond to distance to city center. Longer distance from the metropolitan center correlates with lower property values in the magnitude of 1.82%. However, this relationship is highly income dependent, where devaluation associated with distance is higher for low-income individuals than for high-income individuals (Kestens et al. 2006).

- Chakraborty, Arnab and McMillan, Andrew, “Is Housing Diversity Good for Community Stability?: Evidence from the Housing Crisis,” *Journal of Planning Education and Research*, (2018), https://journals.sagepub.com/doi/10.1177/0739456X18810787
- Kestens, Yan,  Theriault, Marius, and Des Rosiers  Francois "Heterogeneity in hedonic modelling of house
prices: looking at buyers’ household profiles," *Journal of Geographical Systems*, (2006), https://link.springer.com/article/10.1007/s10109-005-0011-8

# data
The sample population for this study is the full set of all census tracts in the Commonwealth of Massachusetts. 

The analysis will include the following variables:

CONTINUOUS

- Percentage of Single, Detached Housing Units (United States Census Bureau 2019)
- Geographic Mobility (Amount of People Who Moved in During the Past Year) (United States Census Bureau 2019)
- Value of Single, Detached Housing Units (United States Census Bureau 2019)

CATEGORICAL

- Majority White or Not Majority White Population (United States Census Bureau 2020)
- Urban Rural Classification (National Center for Health Statistics 2013)

# data table
The dataset includes 1478 census tracks.

```{r load library, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(tidycensus)
library(readxl)
library(knitr)
```

````{r, message = FALSE, include = FALSE, echo = FALSE, warning = FALSE}
census <- get_acs(geography = "tract", 
                        year = 2019,
                        state = "MA",
                        #housing units = HUs
                        #population = pop
                        variables = c(pop = "B01003_001",
                                      HUs = "B25001_001"
                                      ),
                        output = "wide",
                        geometry = TRUE)
```

```{r, include = FALSE, message = FALSE, echo = FALSE, warning = FALSE}

single_family <- get_acs(geography = "tract", 
                        year = 2019,
                        state = "MA",
                        #total of one-detached housing
                        variables = c(oneunit = "B25024_002"),
                        output = "wide",
                        geometry = FALSE)
```

```{r, include = FALSE, message = FALSE, echo = FALSE, warning = FALSE}

value <- get_acs(geography = "tract", 
                        year = 2019,
                        state = "MA",
                        #aggregate value in dollars of units per structure
                        variables = c(one_house_value = "B25080_002",
                                      tot_value = "B25080_001"),
                        output = "wide",
                        geometry = FALSE)

value <- value %>%
  mutate(pct_one_house = round(100 * one_house_valueE / tot_valueE)) %>%
  filter(tot_valueE > 0)
```

```{r, include = FALSE, message = FALSE, echo = FALSE, warning = FALSE}
white <- get_acs(geography = "tract",
                          state = "Massachusetts",
                          year = 2019,
                          output = "wide",
                          variables = c(tot_pop = 'B01003_001',
                                        w_pop = 'B02001_002'),
                          geometry = FALSE)

white <- white %>%
  mutate(pct_white = round(100 * w_popE / tot_popE)) %>%
  filter(tot_popE > 0)
```

```{r, include = FALSE, message = FALSE, echo = FALSE, warning = FALSE}
moved <- get_acs(geography = "tract", 
                 year = 2019,
                 state = "Massachusetts",  
                 variables = c(same_county = "B07001_033", 
                               diff_state = "B07001_065", 
                               same_state = "B07001_049", 
                               abroad = "B07001_081"), 
                 output = "wide", 
                 quiet = FALSE)

moved$tot_moved <- moved$same_countyE + moved$same_stateE + moved$diff_stateE + moved$abroadE

```


```{r, message = FALSE, include = FALSE, echo = FALSE, warning = FALSE}
urban_type <- read_xlsx(path = "data/NCHSURCodes2013.xlsx", 
                      sheet = "NCHSURCodes2013") %>%
  mutate(GEOID = case_when(str_length(as.character(`FIPS code`)) == 5 ~ 
                            as.character(`FIPS code`),
                          str_length(as.character(`FIPS code`)) == 4 ~
                            paste("0", `FIPS code`, sep=""),
                          TRUE ~ "unknown")) %>%
  mutate(type = case_when(`2013 code` == 1 ~ "Large central metro",
                          `2013 code` == 2 ~ "Large fringe metro",
                          `2013 code` == 3 ~ "Medium metro",
                          `2013 code` == 4 ~ "Small metro",
                          `2013 code` == 5 ~ "Micropolitan",
                          `2013 code` == 6 ~ "Non-core",
                          TRUE ~ "unknown")) %>%
  select(GEOID, type)
```

```{r, include = FALSE, message = FALSE, echo = FALSE, warning = FALSE}
#Make Data Column
data <- left_join(census,urban_type) %>%
  left_join(moved) %>%
  left_join(value) %>%
  left_join(single_family) %>%
  left_join(white)
```

```{r, message = FALSE, echo = FALSE, warning = FALSE}

kable(head(data))

```
